<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pedidos Finalizados</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="nordestao.png" type="image/png" />
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="max-w-2xl w-full bg-white rounded-lg shadow-lg p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Pedidos Finalizados</h1>
      <!-- Botão Voltar -->
      <a href="index.html"
         class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
        ← Voltar
      </a>
    </div>

    <div id="pedidosFinalizados" class="space-y-3">
      <div id="loading" class="text-gray-500">Carregando...</div>
      <div id="error" class="hidden text-red-500"></div>
    </div>
  </div>

  <script>
    const url = 'https://pedidosnordestao.onrender.com/pedidos/finalizados';
    const loadingDiv = document.getElementById('loading');
    const errorDiv   = document.getElementById('error');
    const container  = document.getElementById('pedidosFinalizados');

    function formatarTempo(segundos) {
      const h = String(Math.floor(segundos / 3600)).padStart(2, '0');
      const m = String(Math.floor((segundos % 3600) / 60)).padStart(2, '0');
      const s = String(segundos % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    async function carregarPedidosFinalizados() {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error();
        const data = await res.json();

        loadingDiv.style.display = 'none';

        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML += '<p class="text-gray-500">Nenhum pedido finalizado.</p>';
          return;
        }

        data.forEach(p => {
          const criadoEm     = new Date(p.criadoEm).getTime();
          const finalizadoEm = new Date(p.finalizadoEm).getTime();
          const diff         = Math.max(0, Math.floor((finalizadoEm - criadoEm) / 1000));

          const el = document.createElement('div');
          el.className = 'flex justify-between items-center bg-green-50 p-3 rounded-lg';

          el.innerHTML = `
            <div>
              <div class="text-gray-800 font-semibold">${p.numeroCompra}</div>
              <div class="text-gray-700">${p.descricao}</div>
            </div>
            <div class="text-sm text-green-600 font-mono">✅ ${formatarTempo(diff)}</div>
          `;

          container.appendChild(el);
        });
      } catch (err) {
        loadingDiv.style.display = 'none';
        errorDiv.textContent = 'Erro ao carregar pedidos finalizados.';
        errorDiv.classList.remove('hidden');
      }
    }

    carregarPedidosFinalizados();
  </script>
</body>
</html>
